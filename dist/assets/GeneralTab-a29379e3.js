import{k as I,r as p,D as x,j as e,C as j,l as R,n as k,h as w,B as m,F as z,T as C}from"./index-ec96ce2c.js";import{i as B,T as _,a as N,b as $,c as b,d as S,e as O,f as D,g as W,L as U,G as Y,I as V,h as F,j as G,k as P,M as H}from"./index-dbdad209.js";import{M as K,a as q,C as J,b as Q,c as X}from"./chunk-KHDB22PD-de98b878.js";import"./index-7bdd1bff.js";import"./index-36af4268.js";var Z=I({d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",displayName:"ChevronLeftIcon"}),ee=I({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"});const T=(s,o,n)=>{const a=n?{"R-views":"#F8B4B5","R-downloads":"#FBC6CF","R-outlinks":"#FDD9E6","R-conversions":"#fff0aa","N-views":"#059FCC","N-downloads":"#05AFE0","N-outlinks":"#05C0F6","N-conversions":"#fff0aa","L-views":"#9E4F9D","L-downloads":"#A78FB4","L-outlinks":"#C4C8E2","L-conversions":"#fff0aa","ALL-views":"#CCCCCC","ALL-downloads":"#D6D6D6","ALL-outlinks":"#E0E0E0","ALL-conversions":"#fff0aa","L-L":"#8B92B3","R-R":"#D9BAB9","N-N":"#06B9ED"}:{"R-views":"#F1686A","R-downloads":"#F57B90","R-outlinks":"#F88DB6","R-conversions":"#fff0aa","N-views":"#059FCC","N-downloads":"#05AFE0","N-outlinks":"#05C0F6","N-conversions":"#fff0aa","L-views":"#7C3E7B","L-downloads":"#8F70A0","L-outlinks":"#ADB3D7","L-conversions":"#fff0aa","L-ALL":"#8B92B3","R-ALL":"#D9BAB9","N-ALL":"#13D7FC"},d=`${s}-${o}`;return a[d]||"#B8B8B8"},E=(s,o)=>{const n=[];return typeof o=="string"?(s.time.buckets.map(l=>{var i,c,u;const t=l.level.buckets.find(h=>h.key===o),a=((i=t==null?void 0:t.views)==null?void 0:i.value)||0,d=((c=t==null?void 0:t.downloads)==null?void 0:c.value)||0,r=((u=t==null?void 0:t.outlinks)==null?void 0:u.value)||0;n.push(a+d+r)}),n):(s.time.buckets.map(l=>{var d;const t=l.level.buckets.find(r=>r.key===o.scope),a=((d=t==null?void 0:t[o.event])==null?void 0:d.value)||0;n.push(a)}),n)},se=k,ne=R,te=({data:s,scopeLabels:o,eventLabels:n,activeScope:l,t,tabIndex:a})=>{const d=p.useRef(null);return p.useEffect(()=>{const r=B(d.current);if(d.current){const i=[];l==="ALL"?ne.map(g=>{g!=="ALL"&&i.push({name:`${o[g]}`,type:"bar",stack:"total",itemStyle:{color:T(g,"ALL")},data:E(s,g)})}):se.map(f=>({scope:l,event:f})).forEach(f=>{i.push({name:`${o[f.scope]} - ${n[f.event]}`,type:`${f.event===x.C?"line":"bar"}`,yAxisIndex:`${f.event===x.C?1:0}`,stack:`${f.event===x.C?"":"total"}`,itemStyle:{color:T(f.scope,f.event)},data:E(s,f)})});const c=s.time.buckets.map(g=>new Date(g.key_as_string).toLocaleString(`${t("calendar-lang")}`,{month:"short",year:"numeric"})),u=Math.max(...i[0].data),h=Math.max(...i[1].data),L=Math.max(...i[2].data),y=u+h+L,v={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{show:!1},grid:{left:"2%",top:"0%",right:"2%",bottom:"6%",containLabel:!1},yAxis:[{type:"value",max:y,name:"Total Access",nameTextStyle:{fontWeight:"bold",fontSize:13},show:!1},{type:"value",max:y,name:x.C,nameTextStyle:{fontWeight:"bold",fontSize:13},show:!1,alignTicks:!1,axisLine:{show:!0,lineStyle:{color:"#6e9ef1"}},axisLabel:{formatter:"{value}"}}],xAxis:{type:"category",data:c},series:i},A=()=>{r&&r.resize()};return window.addEventListener("resize",A),v&&r.setOption(v),()=>{window.removeEventListener("resize",A),r.dispose()}}},[l,a]),e.jsx(j,{shadow:"sm",borderRadius:"12",p:"6",children:e.jsx("div",{id:"bar-chart",ref:d,style:{height:"500px"}})})},M=(s,o)=>{var t,a,d;if(o==="ALL")return s.level.buckets.reduce((r,i)=>{var c,u,h;return r+(((c=i.views)==null?void 0:c.value)||0)+(((u=i.downloads)==null?void 0:u.value)||0)+(((h=i.outlinks)==null?void 0:h.value)||0)},0);const n=s.level.buckets.find(r=>r.key===o);return((((t=n==null?void 0:n.views)==null?void 0:t.value)||0)+(((a=n==null?void 0:n.downloads)==null?void 0:a.value)||0)+(((d=n==null?void 0:n.outlinks)==null?void 0:d.value)||0)).toLocaleString()},ae=(s,o,n,l)=>{let t=[];return s==="ALL"?t=[l("months"),...Object.keys(o).map(a=>o[a])]:t=[l("months"),...k.map(a=>n[a])],t},oe=(s,o,n)=>{let l=[];return s==="ALL"?l=o.time.buckets.map(t=>[new Date(t.key_as_string).toLocaleString(`${n("calendar-lang")}`,{month:"short",year:"numeric"}),R.map(a=>M(t,a)).join(",")].join(",")):l=o.time.buckets.map(t=>[new Date(t.key_as_string).toLocaleString(`${n("calendar-lang")}`,{month:"short",year:"numeric"}),k.map(a=>{var d,r;return((r=(d=t.level.buckets.find(i=>i.key===s))==null?void 0:d[a])==null?void 0:r.value.toLocaleString())||0}).join(",")].join(",")),l},re=(s,o,n,l,t)=>{const a=ae(s,l,t,n),d=oe(s,o,n),r=[a.join(","),...d].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),u=document.createElement("a");u.href=c,u.download=`${l[s]}-data.csv`,u.click(),URL.revokeObjectURL(c)},le=({data:s,eventLabels:o,activeScope:n,scopeLabels:l,t})=>{const[a,d]=p.useState(0),r=i=>Object.keys(i).map((u,h)=>e.jsxs(S,{children:[" ",i[u]," "]},h));return e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",mt:6,children:e.jsxs(_,{children:[e.jsxs(N,{variant:"striped",colorScheme:"gray",size:"lg",children:[e.jsx($,{children:e.jsxs(b,{children:[e.jsx(S,{children:t("months")}),r(n==="ALL"?l:o)]})}),e.jsx(O,{children:s.time.buckets.map((i,c)=>e.jsxs(b,{children:[e.jsx(D,{children:new Date(i.key_as_string).toLocaleString(`${t("calendar-lang")}`,{month:"short",year:"numeric"})}),n==="ALL"?R.map((u,h)=>e.jsx(D,{children:M(i,u)},h)):k.map((u,h)=>{var L,y;return e.jsx(D,{children:((y=(L=i.level.buckets.find(v=>v.key===n))==null?void 0:L[u])==null?void 0:y.value.toLocaleString())||0},h)})]},c)).slice(10*a,10*(a+1))}),e.jsx(W,{display:"flex",justifyContent:"start",py:"4",children:e.jsx(b,{children:e.jsx(D,{children:e.jsx(w,{onClick:()=>re(n,s,t,l,o),colorScheme:"teal",children:t("csv-button")})})})})]}),e.jsx(m,{display:"flex",justifyContent:"space-evenly",children:e.jsxs(m,{display:"flex",gap:"2",children:[e.jsx(w,{variant:"ghost",onClick:()=>d(a-1),isDisabled:a===0,children:e.jsx(Z,{fontSize:"1.5rem"})}),e.jsx(m,{display:"flex",gap:"2",alignItems:"center",children:Array.from({length:Math.ceil(s.time.buckets.length/10)},(i,c)=>e.jsx(w,{variant:a===c?"solid":"outline",onClick:()=>d(c),children:c+1},c))}),e.jsx(w,{variant:"ghost",onClick:()=>d(a+1),isDisabled:10*(a+1)>=s.time.buckets.length,children:e.jsx(ee,{fontSize:"1.5rem"})})]})})]})})},ie=({data:s,eventLabels:o,activeScope:n,t:l})=>{const[t,a]=p.useState(s.level.buckets.filter(r=>r.key===n));p.useEffect(()=>{const r=[{key:"ALL",doc_count:0,views:{value:s.views.value},outlinks:{value:s.outlinks.value},downloads:{value:s.downloads.value},conversions:{value:s.conversions.value}}],i=s.level.buckets.filter(c=>c.key===n);a(n==="ALL"?r:i)},[n]);const d=[{title:x.V,label:o[x.V],value:s.views.value,icon:e.jsx(z,{})},{title:x.D,label:o[x.D],value:s.downloads.value,icon:e.jsx(U,{})},{title:x.O,label:o[x.O],value:s.outlinks.value,icon:e.jsx(Y,{})},{title:x.C,label:o[x.C],value:s.conversions.value,icon:e.jsx(V,{})}];return e.jsx(m,{children:t.map((r,i)=>e.jsxs(F,{gridTemplateColumns:{base:"repeat(1, minmax(0px, 1fr))",md:"repeat(2, minmax(0px, 1fr))",lg:"repeat(5, minmax(0px, 1fr))"},gap:"4",children:[e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(F,{children:[e.jsxs(m,{display:"flex",gap:"2",children:[e.jsx(C,{as:"span",fontWeight:"600",color:"gray",fontSize:"1.1rem",children:"Total"}),e.jsx(G,{label:l("tooltip-general-panel"),fontSize:"md",children:e.jsx(P,{fontSize:"12px",color:"teal"})})]}),e.jsx(C,{as:"span",fontWeight:"700",fontSize:"1.3rem",children:(r.downloads.value+r.views.value+r.outlinks.value).toLocaleString()})]}),e.jsx(j,{p:"4",bg:"gray.100",variant:"elevated",shadow:"xs",borderRadius:"12",children:e.jsx(H,{})})]})}),d.map((c,u)=>e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(F,{children:[e.jsx(C,{as:"span",fontWeight:"600",color:"gray",fontSize:"1.1rem",children:c.label}),e.jsx(C,{as:"span",fontWeight:"700",fontSize:"1.3rem",children:r[c.title].value.toLocaleString()})]}),e.jsx(j,{p:"4",bg:"gray.100",variant:"elevated",shadow:"xs",borderRadius:"12",children:c.icon})]})},u))]},i))})},de=({t:s,setRefresh:o,setStartDate:n,refresh:l,startDate:t})=>{const a=[{label:`6 ${s("months")}`,callback:new Date(new Date().setFullYear(new Date().getMonth()-6))},{label:`1 ${s("year")}`,callback:new Date(new Date().setFullYear(new Date().getFullYear()-1))},{label:`3 ${s("years")}`,callback:new Date(new Date().setFullYear(new Date().getFullYear()-3))}],d=r=>{n(r),console.log(r),o(!l)};return e.jsx(m,{borderRadius:"12",children:e.jsx(m,{display:"flex",gap:"2",children:a.map(({label:r,callback:i})=>e.jsx(j,{shadow:"sm",borderRadius:"12",p:"1",justifyContent:"center",rounded:"lg",children:e.jsx(w,{onClick:()=>d(i),size:"sm",fontWeight:"bold",variant:t===i?"solid":"outline",children:r})},r))})})},ce=({scopeLabels:s,activeScope:o,setActiveScope:n})=>e.jsx(j,{shadow:"sm",mr:"4",borderRadius:"6",p:"1",children:e.jsxs(K,{children:[e.jsx(q,{as:w,variant:"outline",rightIcon:e.jsx(J,{}),children:s[o]}),e.jsx(Q,{children:s&&Object.keys(s).map(l=>e.jsx(X,{color:"gray.600",fontWeight:"medium",onClick:()=>n(l),children:s[l]},l))})]})}),ue=({t:s,scopeLabels:o,activeScope:n,setActiveScope:l,setStartDate:t,setRefresh:a,refresh:d,startDate:r})=>e.jsx(m,{my:"6",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",children:[e.jsx(m,{display:"flex",alignItems:"center",children:e.jsx(ce,{scopeLabels:o,activeScope:n,setActiveScope:l})}),e.jsx(de,{t:s,setRefresh:a,setStartDate:t,refresh:d,startDate:r})]})}),ge=({data:s,scopeLabels:o,eventLabels:n,activeScope:l,setActiveScope:t,t:a,tabIndex:d,setStartDate:r,setRefresh:i,refresh:c,startDate:u})=>e.jsxs(e.Fragment,{children:[e.jsx(ie,{data:s,scopeLabels:o,eventLabels:n,activeScope:l,t:a}),e.jsx(ue,{t:a,scopeLabels:o,activeScope:l,setActiveScope:t,setStartDate:r,setRefresh:i,refresh:c,startDate:u}),e.jsx(te,{data:s,scopeLabels:o,eventLabels:n,activeScope:l,setActiveScope:t,t:a,tabIndex:d}),e.jsx(le,{data:s,eventLabels:n,scopeLabels:o,activeScope:l,t:a})]});export{ge as default};
